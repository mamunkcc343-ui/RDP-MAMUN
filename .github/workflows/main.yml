      - name: Create RDP User (robust, uses net user)
        shell: powershell
        run: |
          #-- Ensure script runs as Administrator
          $isAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
          if (-not $isAdmin) {
            Write-Error "This step requires Administrator privileges. Exiting."
            exit 1
          }

          #-- username and password (prefer stored secret)
          $username = "mamun"
          if ($env:RDP_PASSWORD) {
            $password = $env:RDP_PASSWORD
            Write-Host "Using password from secret."
          } else {
            $password = "Mamun@2025"   # fallback (not recommended)
            Write-Warning "Using plaintext password in workflow. Consider using a secret named RDP_PASSWORD."
          }

          #-- If user exists, ensure we set the password and add to groups
          $exists = (Get-LocalUser -Name $username -ErrorAction SilentlyContinue)
          if ($exists) {
            Write-Host "User $username exists â€” updating password & group membership."
            NET USER $username $password
          } else {
            Write-Host "Creating local user $username."
            NET USER $username $password /ADD /Y
          }

          #-- Add to Administrators and Remote Desktop Users (idempotent)
          net localgroup "Administrators" $username /ADD 2>&1 | Write-Host
          net localgroup "Remote Desktop Users" $username /ADD 2>&1 | Write-Host

          #-- Ensure account never expires (optional)
          wmic useraccount where name="$username" set PasswordExpires=false | Out-Null

          #-- Expose creds to later steps (keeps visible in logs; consider removing)
          echo "RDP_CREDS=User: $username | Password: $password" >> $env:GITHUB_ENV

          Write-Host "User creation done. Username: $username"
